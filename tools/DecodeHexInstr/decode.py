import subprocess
import os
import sys
offset = 0x34
obj_src = bytearray(b"\x7fELF\x01\x01\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\x00\xf3\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xfc\x00\x00\x00\x05\x00\x00\x004\x00\x00\x00\x00\x00(\x00\x08\x00\x07\x00\x13\x81\xc0\x00A2\x00\x00\x00riscv\x00\x01(\x00\x00\x00\x05rv32i2p0_m2p0_a2p0_f2p0_d2p0_c2p0\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x00\x02\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x00\x03\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x03\x00\x04\x00\x00\x00.symtab\x00.strtab\x00.shstrtab\x00.text\x00.data\x00.bss\x00.riscv.attributes\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x1b\x00\x00\x00\x01\x00\x00\x00\x06\x00\x00\x00\x00\x00\x00\x004\x00\x00\x00\x04\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x02\x00\x00\x00\x00\x00\x00\x00!\x00\x00\x00\x01\x00\x00\x00\x03\x00\x00\x00\x00\x00\x00\x008\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\'\x00\x00\x00\x08\x00\x00\x00\x03\x00\x00\x00\x00\x00\x00\x008\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00,\x00\x00\x00\x03\x00\x00p\x00\x00\x00\x00\x00\x00\x00\x008\x00\x00\x003\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x02\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00l\x00\x00\x00P\x00\x00\x00\x06\x00\x00\x00\x05\x00\x00\x00\x04\x00\x00\x00\x10\x00\x00\x00\t\x00\x00\x00\x03\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xbc\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\x11\x00\x00\x00\x03\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xbd\x00\x00\x00>\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00")


def decode(instr_str):
    obj = obj_src
    instr = bytearray(bytes.fromhex(instr_str))
    instr = instr[::-1]
    obj[offset:offset+len(instr)] = instr
    obj = bytes(obj)
    output = open("tmp.o", "wb")
    output.write(obj)
    output.close()
    p = subprocess.Popen(["./riscv32-unknown-linux-gnu-objdump", '-d', 'tmp.o'], stdout = subprocess.PIPE)
    msg = p.stdout.read()
    msg = msg.splitlines()[-1].decode('utf-8')
    os.remove("tmp.o")
    return msg


if __name__ == "__main__":
    if(len(sys.argv) == 1):
        print("Usage: python decode.py <hex_string_list>")
        exit(1)
    else:
        for s in sys.argv[1:]:
            print(decode(s))

